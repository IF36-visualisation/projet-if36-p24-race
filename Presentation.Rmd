---
title: "Rapport IF36 - 120 years of olympic history"
subtitle: "Semestre : P24"
author: "Mohamed Amine jabote, Thomas François, Freddy Durel Pouna Wantou"
output: 
  html_document:
    runtime: shiny
    viewport: width=device-width, initial-scale=1
---

```{r setup, include=FALSE}
library(dplyr)
library(ggplot2)
library(readr)
library(plotly)
library(tidyr)
library(ggrepel)
library(gridExtra)
library(grid)
library(readxl)
library(GGally)
library(RColorBrewer)
library(tidyverse)
```

```{r loading data, include=FALSE}
data_jo = read_csv('athlete_events.csv')
data_noc_regions <- read_csv('noc_regions.csv')
data_PIB <- read_delim('GDP_per_capita.csv', delim = ';')
data_iso_regions <- read_csv('iso_regions.csv')
```

</br>

<p align="center">
<img src="https://st.depositphotos.com/2793427/4712/i/450/depositphotos_47122635-stock-photo-white-olympics-flag-against-the.jpg" width="80%"/>
</p>

</br>

# Introduction

Avec les **Jeux olympiques de Paris 2024** à l'horizon et l'engouement actuel en France pour cet événement, nous avons choisi de travailler sur le thème des Jeux olympiques à travers les âges.

Pour cela, nous avons décidé d'utiliser le jeu de données **"120 ans d'histoire des Jeux Olympiques"** contenant les données de 28 éditions d'été et 22 d'hiver des Jeux Olympiques, ce qui équivaut à un peu moins de 136 000 individus, répartis sur 15 variables. Ces variables comprennent des informations telles que les noms des athlètes, leur âge, poids, taille, la saison des Jeux Olympiques, les médailles remportées, etc. Les données proviennent du site www.sports-reference.com et sont le résultat d'un travail de recherche réalisé par un groupe intéressé par l'histoire des Jeux Olympiques.

Avec des membres de notre groupe ayant des niveaux de connaissances variés sur les Jeux Olympiques, l'étude de ce jeu de données nous offre l'opportunité unique de plonger dans l'histoire et les tendances de cet événement emblématique, tout en élargissant notre compréhension de l'impact du sport sur la société à travers les âges.

</br>

# Plan d'analyse

Nous avons compilé une série de questions que nous tenterons de résoudre en utilisant le jeu de données. Ces questions sont divisées en deux catégories principales : l'évolution des Jeux Olympiques et les performances des athlètes.

### L'évolution des Jeux Olympiques

1. Quels pays ont exercé une domination dans l'histoire des Jeux Olympiques ?
2. Comment les Jeux Olympiques d'été se différencient-ils aux Jeux Olympiques d'hiver ?
3. Comment varie le nombre d'épreuves sportives et le nombre d'athlètes participant aux Jeux Olympiques au fil du temps ?
4. Est-ce que le pays hôte des Jeux Olympiques bénéficie d'un avantage par rapport aux autres nations participantes ?
5. Existe-t-il une relation entre le niveau économique d'un pays et ses performances aux Jeux Olympiques ?

### Les athlètes

6. Quels sont les athlètes qui ont marqué les jeux olympiques ?
7. Quels sont les impacts des caractéristiques physiques sur les résultats ?
8. Est-ce que la répartition des médailles entre hommes et femmes varie selon les pays ?
9. Comment la représentation des femmes aux Jeux Olympiques a-t-elle évolué au fil du temps ?

</br>

# Analyse

</br>

## 1. Les pays donminants

Pour commencer notre analyse, nous allons nous concentrer sur la première question : Quels pays ont exercé une domination dans l'histoire des Jeux Olympiques ?  
Cette question vise à identifier les nations qui se sont distinguées par leurs performances exceptionnelles et régulières aux Jeux Olympiques.  
Cette analyse sera également utile pour mieux comprendre les résultats des prochaines questions analysées, en fournissant un contexte sur les dynamiques historiques et les tendances de performance des différentes nations.

</br></br>

```{r Question1-A, echo=FALSE, fig.align="center"}
country_medal_counts <- data_jo %>%
  group_by(NOC) %>%
  filter(!is.na(Medal)) %>%
  summarise(total_medals = n())

# Define bins for the histogram
bins <- c(0, 1, 10, 100, 1000, Inf)

labels_bins <- c("0-1", "1-10", "10-100", "100-1000", "1000+")

# Create histogram with defined bins
ggplot(country_medal_counts, aes(x = cut(total_medals, bins, labels = labels_bins))) +
  geom_bar(stat = "count", fill = "skyblue", color = "black") +
  labs(x = "Number of Medals", y = "Number of Countries", title = "Distribution of Countries by Medal Counts") +
  scale_x_discrete(labels = labels_bins) +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5, size = 18))

```

</br>

```{r Question1-B, echo=FALSE, message=FALSE, warning=FALSE, fig.align="center", fig.width = 9}


number_of_medals <- data_jo %>%
  distinct() %>%
  filter(!is.na(Medal)) %>%
  left_join(data_noc_regions, by = "NOC") %>%
  group_by(region) %>%
  summarize(Medals = n()) %>%
  right_join(data_iso_regions, by = "region") %>%
  mutate(Medals = ifelse(is.na(Medals), 0, Medals))

plot_ly(
  data = number_of_medals,
  type = 'choropleth',
  locations = ~ ISO,
  z = ~ Medals,
  text = ~ region,
  colorscale = list(
    c(0, 0.01,  0.5, 0.8, 1),
    c('white', 'lightblue', 'blue' , 'darkblue', 'black')
  ),
  autocolorscale = FALSE,
  marker = list(line = list(color = 'rgb(180,180,180)', width = 0.5)),
  colorbar = list(title = "Nombre de médailles")
) %>%
  layout(
    title = list(
      text = "Nombre de médailles obtenus par pays",
      y = 0.99,
      font = list(size = 24)
    ),
    margin = list(
      l = 0,
      r = 0,
      b = 0,
      t = 20,
      pad = 0
    ),
    geo = list(
      showframe = FALSE,
      showcoastlines = FALSE,
      projection = list(type = 'Mercator')
    )
  )
```

Comme on peut voir sur ces deux graphiques, la majorité des pays on aucune ou peu de médailles (entre 0 et 100) et une minorité de pays à un grand nombre de médailles (500+). On peut voir sur la carte que les pays ayant un grand nombre de médailles sont principalements situés en Amérique du Nord et en Europe ainsi que les pays considérés comme riches (Chine, Australie, Brésil) comme nous le veront à la question 5.

</br><hr width="20%" /></br>

```{r Question1-C, echo=FALSE, fig.align="center", fig.width = 14}
data_filtered <- data_jo %>%
  distinct() %>%
  filter(!is.na(Medal)) %>%
  left_join(data_noc_regions, by = "NOC")


# Aggregate the total medal count per country and identify the top 10 countries
top_30_countries <- data_filtered %>%
  count(region) %>%
  top_n(30, n)


# Filter the original data to include only these top 10 countries
top_30_data <- data_filtered %>%
  filter(region %in% top_30_countries$region)

top_30_data$Medal <-
  factor(top_30_data$Medal, levels = c("Gold", "Silver", "Bronze"))

# Aggregate the data to count the number of each type of medal per country
medals_per_country <- top_30_data %>%
  count(region, Medal)

# Create a stacked histogram of the number of medals per country by type, ordered by total medals
ggplot(medals_per_country, aes(
  x = reorder(region,-n),
  y = n,
  fill = Medal
)) +
  geom_bar(stat = "identity") +
  labs(title = "Stacked Histogram of Medals per Country (Top 30)",
       x = "Country",
       y = "Number of Medals",
       fill = "Medal Type") +
  scale_fill_manual(values = c(
    "Gold" = "#FFD700",
    "Silver" = "#C0C0C0",
    "Bronze" = "#CD7F32"
  )) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
  theme(plot.title = element_text(hjust = 0.5, size = 24))

```

</br>

```{r Question1-D, echo=FALSE, fig.align="center", fig.width = 14}
data_filtered_2 <- data_jo %>%
  distinct() %>%
  left_join(data_noc_regions, by = "NOC")

athletes_per_region <- data_filtered_2 %>%
  group_by(region) %>%
  summarize(Distinct = n_distinct(ID), Total = n()) %>%
  arrange(desc(Total)) %>%
  head(30)

ggplot(athletes_per_region, aes(x = reorder(region,-Total))) +
  geom_bar(aes(y = Total, fill = "Total"), stat = "identity", alpha = 1) +
  geom_bar(aes(y = Distinct, fill = "Distinct"),
           stat = "identity",
           alpha = 1) +
  labs(title = "Numbers of Athletes per Region",
       x = "Region",
       y = "Count",
       fill = "Legend") +
  scale_fill_manual(values = c("Total" = "lightblue", "Distinct" = "lightgreen"),
                    name = "Type") +
  theme_minimal() +
  theme(axis.text.x = element_text(
    angle = 90,
    vjust = 0.5,
    hjust = 1
  )) +
  theme(plot.title = element_text(hjust = 0.5, size = 24))

```

</br>

Il est intéréssant de remarquer que les même pays sont dans le top de classement de médailles de du nombre d'athlètes envoyés avec les même 6 pays au top des classements (États-Unis, Russie, Allemagne, Angleterre, France et Italie)

</br><hr width="20%" /></br>

```{r Question1-E, echo=FALSE, message=FALSE, warning=FALSE, fig.align="center"}
country_summary_with_regions <- data_jo %>%
  left_join(data_noc_regions, by = "NOC") %>%
  group_by(region) %>%
  summarise(Medailles = sum(!is.na(Medal)),
            Athletes = n_distinct(Name),) %>%
  arrange(desc(Medailles)) %>%
  filter(!is.na(region))

ggplot(country_summary_with_regions,
       aes(x = Medailles, y = Athletes, label = region)) +
  geom_point(color = "blue",
             size = 3,
             alpha = 0.5) +
  geom_smooth(
    method = "lm",
    se = FALSE,
    color = "black",
    size = 0.3
  ) +
  geom_text_repel(size = 3, segment.color = "transparent") +
  labs(x = "Nombre de Medailles", y = "Nombre d'athlètes envoyés") +
  theme_minimal() +
  ggtitle("Medailles vs. Athlètes envoyés par pays") +
  theme(plot.title = element_text(hjust = 0.5, size = 18))

```

</br>

Ce graphique indique la performance de chaque pays en fesant un ratio du nombre de médailles obtenus pour le nombre d'athlètes envoyés.

Il est remarquable de constater que les pays au-dessus de la ligne de tendance sous-performent par rapport à cette moyenne, tandis que ceux en dessous sur-performent (notamment la Russie, les États-Unis et l'Allemagne), alors que ceux au dessus de la ligne sous-performent.

</br><hr width="20%" /></br>

#### Conclusion :
Nous avons vu que les résulats aux Jeux Olympiques ne sont pas homogènes, il y a un grand nombre de pays ayant peu de participation alors qu'une poignée à énormément de participation. Il est important de garder ces résultats en tête dans les prochaines analyses afin de mieux les apréhender.

</br><hr /></br>

## 2. La différence des sessions d'hiver et d'été

Pour poursuivre notre analyse, nous allons nous concentrer sur la deuxième question : "Comment les Jeux Olympiques d'été se différencient-ils des Jeux Olympiques d'hiver ?"

Cette question vise à examiner les différences et similitudes entre les éditions estivales et hivernales des Jeux Olympiques. Cette analyse nous permettra de mieux comprendre les spécificités de chaque saison olympique et d'identifier les tendances uniques qui caractérisent les Jeux d'été et d'hiver. De plus, cette étude fournira un contexte précieux pour les questions suivantes, en mettant en lumière les variations saisonnières dans l'organisation et les performances des Jeux Olympiques.

</br></br>

```{r Question2-A, echo=FALSE, fig.align="center", fig.width = 10}

# Filter data for Summer and Winter seasons
summer_data <- data_jo %>% distinct() %>% filter(Season == "Summer")
winter_data <- data_jo %>% distinct() %>% filter(Season == "Winter")

# Count unique athletes for each edition (Year) and Season
summer_athletes_count <- summer_data %>%
  group_by(Year) %>%
  summarise(nombre_athletes = n_distinct(Name))

winter_athletes_count <- winter_data %>%
  group_by(Year) %>%
  summarise(nombre_athletes = n_distinct(Name))

combined_data <- bind_rows(
  mutate(summer_athletes_count, Season = "Summer"),
  mutate(winter_athletes_count, Season = "Winter")
)

# Plotting with ggplot2
ggplot(combined_data, aes(x = Year, y = nombre_athletes, color = Season)) +
  geom_line() +
  geom_point() +
  labs(x = "Année", y = "Nombre d'athlètes", color = "Session") +
  ggtitle("Nombre d'athlètes aux Jeux Olympique d'été et d'hiver") +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5, size = 20))
```

</br>

```{r Question2-B, echo=FALSE, fig.align="center", fig.width = 14}


# Count unique athletes for each edition (Year) and Season
summer <- summer_data %>%
  group_by(Year) %>%
  summarise(event = n_distinct(Event), sport = n_distinct(Sport))

winter <- winter_data %>%
  group_by(Year) %>%
  summarise(event = n_distinct(Event), sport = n_distinct(Sport))

combined_data <- bind_rows(mutate(summer, Season = "Summer"),
                           mutate(winter, Season = "Winter"))

# Plotting with ggplot2
p1 <-
  ggplot(combined_data, aes(x = Year, y = sport, color = Season)) +
  geom_line() +
  geom_point() +
  labs(x = "Année", y = "Nombre de sports", color = "Session") +
  theme_minimal() +
  guides(color = "none")

p2 <-
  ggplot(combined_data, aes(x = Year, y = event, color = Season)) +
  geom_line() +
  geom_point() +
  labs(x = "Année", y = "Nombre d'épreuves", color = "Session") +
  theme_minimal() +
  guides(color = "none")

grid.arrange(
  p1,
  p2,
  ncol = 2,
  top = textGrob("Evolution du nombre de sport et d'epreuves", gp = gpar(fontsize =
                                                                           28))
)
```

</br>

On peut clairement voir sur le premier graphique que la participation aux Jeux Olympiques d'été est nettement supérieure à celle des Jeux d'hiver. On peut également observer sur le même graphique des pics de baisse de participation qui seront expliqués dans la prochaine partie (Question 3).

Les deux autres graphiques mettent en lumière une des raisons de cette disparité entre les deux sessions : le nombre de sports et d'épreuves dans chaque session. En effet, pendant la session d'été, il y a bien plus de sports que pendant celle d'hiver. Il est quand même intéressant de voir que le nombre d'épreuves et de sports augmente de la même manière, que ce soit pour les Jeux d'été ou d'hiver.


</br><hr width="20%" /></br>

```{r Question2-C, echo=FALSE, message=FALSE, warning=FALSE, fig.align="center", fig.width = 9}


ratio_summer_winter <- data_jo %>%
  group_by(Season) %>%
  summarise(unique_athletes = n_distinct(ID)) %>%
  spread(Season, unique_athletes) %>%
  mutate(ratio = Summer / Winter) %>%
  select(ratio) %>%
  pull()

data_filtered <- data_jo %>%
  distinct() %>%
  left_join(data_noc_regions, by = "NOC") %>%
  group_by(region, Season) %>%
  summarize(unique_athletes = n_distinct(ID)) %>%
  ungroup() %>%
  spread(key = Season, value = unique_athletes) %>%
  mutate(Summer = ifelse(is.na(Summer), 0, Summer),
         Winter = ifelse(is.na(Winter), 0, Winter)) %>%
  mutate(ratio = ifelse(Winter == 0, 100, Summer / Winter / ratio_summer_winter)) %>%
  mutate(ratio = pmin(ratio, 10)) %>%
  left_join(data_iso_regions, by = "region")

plot_ly(
  data = data_filtered,
  type = 'choropleth',
  locations = ~ ISO,
  z = ~ ratio,
  text = ~ region,
  colorscale = list(c(0, 0.1, 0.5, 1), c('blue', 'pink', 'red' ,'darkred')),
  autocolorscale = FALSE,
  marker = list(line = list(color = 'rgb(180,180,180)', width = 0.5)),
  colorbar = list(title = "Préférence de session\nété (rouge) / hiver (bleu)")
) %>%
  layout(
    title = list(
      text = "Participation aux Jeux Olympiques d'été / d'hiver par pays",
      y = 0.99,
      font = list(size = 24)
    ),
    geo = list(
      showframe = FALSE,
      showcoastlines = FALSE,
      projection = list(type = 'Mercator')
    )
  )
```

</br>

Cette carte indique pour chaque pays le ratio d'athlètes envoyés aux Jeux Olympiques d'été et d'hiver. Le ratio de préférence est normalisé par rapport à la moyenne des pays : les pays envoient en moyenne trois fois plus d'athlètes aux Jeux Olympiques d'été qu'aux Jeux d'hiver. Il est donc logique de voir que les pays "chauds" (Amérique du Sud, Afrique, Asie du Sud-Est) ont un ratio très élevé, car ils n'envoient presque aucun athlète aux Jeux d'hiver. De la même façon, les pays "froids" (Canada, Russie, pays nordiques...) favorisent les Jeux Olympiques d'hiver.

</br><hr width="20%" /></br>

#### Conclusion :
Notre analyse des Jeux Olympiques d'été et d'hiver met en évidence des différences significatives en termes de participation, de nombre de sports et d'épreuves, ainsi que des préférences des pays en fonction de leur climat. Les Jeux d'été attirent un plus grand nombre de participants et proposent une variété de sports plus large comparé aux Jeux d'hiver. Les variations saisonnières dans l'organisation et les performances des Jeux sont influencées par des facteurs géographiques et climatiques, avec les pays "chauds" favorisant les Jeux d'été et les pays "froids" favorisant les Jeux d'hiver.

</br><hr /></br>

## 3. La participation à travers les âges

Pour continuer notre analyse, nous allons nous concentrer sur la troisième question : "Comment varie le nombre d'épreuves sportives et le nombre d'athlètes participant aux Jeux Olympiques au fil du temps ?"

Cette question vise à explorer l'évolution des Jeux Olympiques en termes de diversité des sports proposés et de participation des athlètes. En examinant les données historiques, nous analyserons les tendances dans l'augmentation ou la diminution du nombre d'épreuves sportives ainsi que le nombre d'athlètes participants au fil des différentes éditions des Jeux. Cette analyse nous aidera à comprendre les facteurs ayant influencé ces changements, en montrant comment l'évolution des Jeux a reflété et influencé les dynamiques du monde sportif international.

</br>

```{r Question3-A, echo=FALSE, fig.align="center", fig.width = 10}
summer_data <-
  data_jo %>%
  distinct() %>%
  filter(Season == "Summer") %>%
  group_by(Year) %>%
  summarise(nombre_athletes = n_distinct(Name),
            nombre_pays = n_distinct(NOC))

# Plotting with ggplot2
ggplot(summer_data, aes(x = Year)) +
  geom_line(aes(y = nombre_athletes), color = "darkblue") +
  geom_point(aes(y = nombre_athletes), color = "darkblue") +
  geom_bar(
    aes(y = nombre_pays * 50),
    stat = "identity",
    alpha = 0.5,
    fill = "green"
  ) +
  scale_y_continuous(name = "Nombre d'athlètes",
                     sec.axis = sec_axis( ~ . * (1 / 50), name = "Nombre de pays")) +
  labs(x = "Année", color = "Session") +
  ggtitle("Nombre d'athlètes et de pays aux Jeux Olympiques d'été") +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5, size = 20))
```

<br>

Ce graphique est intéressant car il permet de constater que les Jeux Olympiques n'ont pas eu lieu pendant la Seconde Guerre mondiale (1939-1945). De plus, il y a eu trois baisses significatives de la participation aux Jeux Olympiques d'été, en 1904, 1932, 1956, et de 1976 à 1984. Pendant ces six éditions, divers problèmes ont empêché un certain nombre de nations de participer aux événements :

- En 1904 et 1932 : Les Jeux Olympiques ont été organisés dans des villes des États-Unis : Saint-Louis et Los Angeles. Ce choix de localisation impliquait un voyage long et difficile pour les pays participants, principalement européens à cette époque.

- En 1956 : De nombreux conflits ont dissuadé de nombreux athlètes de participer : l'affaire du Canal de Suez, le conflit entre l'Égypte et Israël, la violence en Afrique du Nord, etc. De plus, la ville hôte était Melbourne en Australie, éloignée du continent européen qui envoyait le plus de participants.

- De 1976 à 1984 : Il y a eu des boycotts des Jeux Olympiques dans le contexte de la guerre froide. Le boycott des Jeux Olympiques organisés en Russie ou aux États-Unis permettait de protester contre les événements de l'époque. Il est intéressant de voir que c'est seulement à cette occasion qu'il y a eu une vraie baisse du nombre de pays participants.

La carte ci-dessous indique les nations ayant boycotté (partiellement ou complètement) les éditions des Jeux Olympiques d'été pendant cette période :

</br>

<p align="center">
<img src="https://upload.wikimedia.org/wikipedia/commons/8/84/Olympic_boycotts_1976_1980_.png" width="80%"/>
</p>

</br><hr width="20%" /></br>

```{r Question3-B, echo=FALSE, message=FALSE, warning=FALSE, fig.align="center", fig.width = 10}

# Count unique athletes for each edition (Year) and Season
athletes_count_year <- data_jo %>%
  distinct() %>%
  group_by(Year, Season) %>%
  #filter(Season == "Summer") %>%
  summarise(nombre_athletes = n_distinct(Name), nombre_sport = n_distinct(Sport), Season) %>%
  distinct()

# Plotting with ggplot2
ggplot(athletes_count_year, aes(x = Year, y = nombre_athletes / nombre_sport, color = Season)) +
  geom_line() +
  geom_point() +
  labs(x = "Année", y = "Nombre d'athlètes / sport", color = "Session") +
  ggtitle("Participation aux Jeux Olympique ajusté au nombre de sports") +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5, size = 20)) +
  facet_grid(. ~ Season) + 
  guides(color = "none")
```

</br>

Dans ce graphique, nous pouvons observer l'impact du nombre de sports sur la participation. En effet, lorsque nous normalisons la participation aux Jeux Olympiques par rapport au nombre de sports disponibles, nous remarquons que la participation par sport est assez similaire entre les différentes éditions.

</br><hr width="20%" /></br>

#### Conclusion :
Notre analyse nous a permis de retracer l'évolution des Jeux Olympiques à travers le prisme du nombre d'épreuves sportives et de la participation des athlètes. Nous avons constaté des fluctuations significatives dans la participation, souvent influencées par des facteurs géopolitiques et logistiques, tels que les conflits mondiaux ou les choix de localisation des Jeux. Les périodes de baisse de participation, telles que les années 1904, 1932, 1956 et 1976-1984, ont été marquées par des événements historiques majeurs et des boycotts politiques. Malgré ces fluctuations, notre analyse révèle une constante : une participation relativement stable par sport, suggérant une diversité maintenue malgré les défis rencontrés par les Jeux Olympiques au fil du temps.

</br><hr /></br>

## 4. L'impact du pays hôte

Introduction

</br>

Graphiques

</br><hr width="20%" /></br>

#### Conclusion :

</br><hr /></br>

## 5. L'impact du niveau économique

Introduction

</br>

Graphiques

```{r Question5-A, echo=FALSE, message=FALSE, warning=FALSE, fig.align="center", fig.width = 10}
# Renommer la première colonne de data_PIB en "Country" pour la jointure
names(data_PIB)[1] <- "Country"

# Préparer les données des Jeux Olympiques
data_jo <- data_jo %>%
  filter(!is.na(Medal)) %>%
  group_by(NOC, Year) %>%
  summarise(total_medals = n()) %>%
  ungroup()

# Préparer les données de PIB par habitant
data_PIB_long <- data_PIB %>%
  pivot_longer(cols = starts_with('19') | starts_with('20') | starts_with('21'), names_to = "Year", values_to = "GDP_per_capita") %>%
  mutate(Year = as.numeric(Year)) %>%
  mutate(GDP_per_capita = as.numeric(GDP_per_capita))  # Assurez-vous que les valeurs de GDP_per_capita sont numériques

# Fusionner les données des JO avec les régions NOC
data_jo <- data_jo %>%
  left_join(data_noc_regions, by = "NOC")

# Fusionner les données des médailles avec les données de PIB par habitant
data_combined <- data_jo %>%
  left_join(data_PIB_long, by = c("region" = "Country", "Year"))

# Filtrer les données complètes
data_combined <- data_combined %>%
  filter(!is.na(GDP_per_capita))

# Créer des tranches de PIB par habitant en utilisant des quantiles
data_combined <- data_combined %>%
  mutate(GDP_bin = cut(GDP_per_capita, breaks = quantile(GDP_per_capita, probs = seq(0, 1, by = 0.1), na.rm = TRUE), include.lowest = TRUE))

# Modifier les étiquettes des tranches de PIB
labels <- c("<1000", "1000-2000", "2000-3000", "3000-4000", "4000-5000", "5000-6000", "6000-7000", "7000-8000", "8000-9000", ">=9000")

# Créer un box plot avec Plotly
p <- plot_ly(data_combined, y = ~total_medals, x = ~GDP_bin, type = 'box', boxpoints = 'all',
             jitter = 0.3, pointpos = -1.8, marker = list(color = 'rgba(152, 0, 0, .8)'),
             text = ~paste('Country:', region, '<br>Year:', Year)) %>%
  layout(title = "Distribution des médailles par tranches de PIB par habitant",
         xaxis = list(title = "Tranches de PIB par habitant (USD)", 
                      categoryorder = "array",
                      categoryarray = unique(data_combined$GDP_bin),
                      ticktext = labels,
                      tickvals = unique(data_combined$GDP_bin)),
         yaxis = list(title = "Nombre total de médailles"))

# Ajouter des annotations
annotations <- list(
  list(x = 0.5, y = 1, xref = "paper", yref = "paper", text = "", 
       showarrow = FALSE, xanchor = "center", yanchor = "top", font = list(size = 20))
)

p <- p %>% layout(annotations = annotations)

# Afficher le graphique
p

```


</br><hr width="20%" /></br>

#### Conclusion :

</br><hr /></br>

## 6. Les athlètes dominants

Introduction

</br>

Graphiques

</br><hr width="20%" /></br>

#### Conclusion :

</br><hr /></br>

## 7. Le physiques des athlètes

Introduction

</br>

Graphiques
```{r Question7_graphe1, echo=FALSE, message=FALSE, warning=FALSE, fig.align="center", fig.width = 10}

# Charger les données
data_jo <- read_csv("athlete_events.csv")
# Préparer les données des Jeux Olympiques
data_filtered <- data_jo %>%
  distinct() %>%
  filter(!is.na(Medal)) %>%
  left_join(data_noc_regions, by = "NOC")

# Créer des tranches d'âge
data_filtered <- data_filtered %>%
  mutate(Age_bin = cut(Age, 
                       breaks = seq(10, 60, by = 10), 
                       right = FALSE, 
                       include.lowest = TRUE))

# Filtrer les données pour inclure seulement les lignes avec un âge disponible
data_filtered <- data_filtered %>%
  filter(!is.na(Age_bin))

# Agréger les données pour compter le nombre de médailles par tranche d'âge
medals_per_age_bin <- data_filtered %>%
  count(Age_bin, Medal)

# Créer un graphique en barres empilées pour les médailles par tranche d'âge
ggplot(medals_per_age_bin, aes(x = Age_bin, y = n, fill = Medal)) +
  geom_bar(stat = "identity") +
  labs(title = "Distribution des médailles olympiques par tranche d'âge",
       x = "Tranche d'âge (années)",
       y = "Nombre de médailles",
       fill = "Type de médaille") +
  scale_fill_manual(values = c("Gold" = "#FFD700", "Silver" = "#C0C0C0", "Bronze" = "#CD7F32")) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
  theme(plot.title = element_text(hjust = 0.5, size = 24))

# Afficher le graphique


```



</br><hr width="20%" /></br>

```{r Question7-graphe2, echo=FALSE, message=FALSE, warning=FALSE, fig.align="center", fig.width = 10}
# Importation des données


# Suppression des valeurs manquantes de Height et Weight
data_jo <- data_jo %>% filter(!is.na(Height) & !is.na(Weight))

# Création d'une variable Age_group pour regrouper les âges en tranches
data_jo <- data_jo %>%
  mutate(Age_group = cut(Age, breaks = c(10, 20, 30, 40, 50, 60), 
                         labels = c("10-20", "20-30", "30-40", "40-50", "51-60"),
                         include.lowest = TRUE)) %>%
  filter(!is.na(Age_group) & Age_group != "51-60")

# Réordonner les tranches d'âge
data_jo$Age_group <- factor(data_jo$Age_group, levels = c("10-20", "20-30", "30-40", "40-50"))

# Calculer la répartition des athlètes par tranche d'âge
age_group_counts <- data_jo %>% count(Age_group)

# Création du graphique en barres avec ggplot
p <- ggplot(data = age_group_counts, aes(x = Age_group, y = n, fill = Age_group)) +
  geom_bar(stat = "identity", position = "dodge") +
  geom_text(aes(label = n), vjust = -0.5, size = 3) +
  labs(title = "Répartition des athlètes olympiques par tranche d'âge",
       x = "Tranche d'âge",
       y = "Nombre d'athlètes") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1),
        plot.title = element_text(hjust = 0.5))

# Afficher le graphique
print(p)

```

</br><hr width="20%" /></br>

```{r, echo=FALSE, message=FALSE, warning=FALSE, fig.align="center", fig.width = 9}

# Importation des données
data <- read_csv("athlete_events.csv")

# Filtrer les athlètes médaillés
medalists <- data %>%
  filter(!is.na(Medal)) %>%
  drop_na(Height, Weight)

# Créer une fonction pour générer le graphique de chaque sport avec une couleur spécifique
create_sport_plot <- function(data, point_color) {
  # Ajuster un modèle de régression linéaire
  fit <- lm(Weight ~ Height, data = data)
  
  plot_ly(data, x = ~Height, y = ~Weight, type = 'scatter', mode = 'markers',
          color = ~Sport, colors = point_color, opacity = 0.6) %>%
    add_trace(x = ~Height, y = ~fitted(fit),
              mode = 'lines', line = list(color = 'black')) %>%
    layout(title = "Relation entre la taille et le poids des athlètes médaillés",
           xaxis = list(title = "Taille (cm)"),
           yaxis = list(title = "Poids (kg)"))
}

# Obtenir une liste de couleurs pour chaque sport
unique_sports <- unique(medalists$Sport)
color_palette <- colorRampPalette(brewer.pal(11, "Set3"))(length(unique_sports))

# Créer le graphique en nuage de points pour tous les sports
plot_all_sports <- create_sport_plot(medalists, color_palette)

# Afficher le graphique
plot_all_sports


```
</br><hr width="20%" /></br>


```{r, echo=FALSE, message=FALSE, warning=FALSE, fig.align="center", fig.width = 9}


# Filtrer les athlètes médaillés pour les trois sports
sports <- c("Swimming", "Athletics", "Judo")
medalists <- data_jo %>%
  filter(!is.na(Medal) & Sport %in% sports) %>%
  drop_na(Height, Weight)

# Fonction pour créer un graphique pour un sport donné avec des couleurs spécifiques
create_sport_plot <- function(sport_name, point_color) {
  sport_data <- medalists %>% filter(Sport == sport_name)
  plot_ly(sport_data, x = ~Height, y = ~Weight, type = 'scatter', mode = 'markers',
          marker = list(color = point_color, opacity = 0.6)) %>%
    add_trace(x = ~Height, y = ~fitted(lm(Weight ~ Height, data_jo = sport_data)),
              mode = 'lines', line = list(color = 'black')) %>%
    layout(title = paste("Relation entre la taille et le poids des athlètes médaillés en", sport_name),
           xaxis = list(title = "Taille (cm)"),
           yaxis = list(title = "Poids (kg)"),
           showlegend = FALSE)
}

# Créer les graphiques pour chaque sport avec les couleurs spécifiées
plot_swimming <- create_sport_plot("Swimming", "blue")
plot_athletics <- create_sport_plot("Athletics", "brown")
plot_judo <- create_sport_plot("Judo", "red")

# Afficher les graphiques
plot_swimming

```

</br><hr width="20%" /></br>

```{r, echo=FALSE, message=FALSE, warning=FALSE, fig.align="center", fig.width = 9}  

plot_athletics

```
</br><hr width="20%" /></br>

```{r, echo=FALSE, message=FALSE, warning=FALSE, fig.align="center", fig.width = 9}  
plot_judo
```



#### Conclusion :

</br><hr /></br>

## 8. La répartition homme / femme

Introduction

</br>

Graphiques

</br><hr width="20%" /></br>

#### Conclusion :

</br><hr /></br>

## 9. La place des femmes à travers le temps

Introduction

</br>

```{r Question9-A, echo=FALSE, message=FALSE, warning=FALSE, fig.align="center", fig.width = 9}
data_filtered <- data_jo %>%
  distinct() %>%
  left_join(data_noc_regions, by = "NOC") %>%
  group_by(region, Sex) %>%
  summarize(unique_athletes = n_distinct(ID)) %>%
  ungroup() %>%
  spread(key = Sex, value = unique_athletes) %>%
  mutate(F = ifelse(is.na(F), 0, F),
         M = ifelse(is.na(M), 0, M)) %>%
  mutate(ratio = M / F) %>%
  mutate(ratio = pmin(ratio, 10)) %>%
  left_join(data_iso_regions, by = "region")

plot_ly(
  data = data_filtered,
  type = 'choropleth',
  locations = ~ ISO,
  z = ~ ratio,
  text = ~ region,
  colorscale = list(c(0, 0.1, 0.2,  1),
                    c('deeppink', 'white', 'blue', 'black')),
  autocolorscale = FALSE,
  marker = list(line = list(color = 'rgb(180,180,180)', width = 0.5)),
  colorbar = list(title = 'Ratio H / F')
) %>%
  layout(
    title = 'Ratio homme / femme aux Jeux Olympiques par pays',
    geo = list(
      showframe = FALSE,
      showcoastlines = FALSE,
      projection = list(type = 'Mercator')
    )
  )
```

</br><hr width="20%" /></br>
```{r Question9-B,echo=FALSE, message=FALSE, warning=FALSE, fig.align="center", fig.width = 10}


# Filter data for Summer and Winter seasons
summer_data <- data_jo %>% distinct() %>% filter(Season == "Summer")
winter_data <- data_jo %>% distinct() %>% filter(Season == "Winter")

# Count unique female athletes for each edition (Games)
summer_female_count <- summer_data %>% filter(Sex == "F") %>% group_by(Games) %>% summarise(Nombre_femmes = n_distinct(Name))
winter_female_count <- winter_data %>% filter(Sex == "F") %>% group_by(Games) %>% summarise(Nombre_femmes = n_distinct(Name))

combined_female_data <- bind_rows(
  mutate(summer_female_count, Season = "Summer"),
  mutate(winter_female_count, Season = "Winter")
)

# Calculer la proportion de femmes parmi les athlètes pour chaque édition des Jeux Olympiques
proportion_femmes <- data_jo %>%
  group_by(Games) %>%
  summarise(Proportion_femmes = mean(Sex == "F", na.rm = TRUE))

# Fusionner les données de nombre total de femmes et de proportion de femmes
data_femmes <- left_join(summer_female_count, proportion_femmes, by = "Games")

# Créer un graphique en ligne interactif avec Plotly pour visualiser les proportions au fil du temps
plot_ly(data_femmes, x = ~Games, y = ~Proportion_femmes, type = 'scatter', mode = 'lines', line = list(color = 'blue')) %>%
  add_trace(y = ~Nombre_femmes, name = "Nombre de femmes ", yaxis = "y2", type = 'scatter', mode = 'lines', line = list(color = 'red')) %>%
  layout(title = "Evolution de la Participation des femmes aux Jeux Olympiques",
         xaxis = list(title = "Édition des Jeux Olympiques"),
         yaxis = list(title = "Proportion de femmes parmi les athlètes", side = "left"),
         yaxis2 = list(title = "Nombre de femmes", side = "right", overlaying = "y"),
         hovermode = "closest",
         showlegend = TRUE,
         legend = list(orientation = "h"))



```

</br><hr width="20%" /></br>

```{r Question9-C,echo=FALSE, message=FALSE, warning=FALSE, fig.align="center", fig.width = 10}
# Filtrer les données pour les médailles et regrouper par année et sexe
medals_by_gender <- data_jo %>%
  filter(!is.na(Medal)) %>%
  group_by(Year, Sex) %>%
  summarise(total_medals = n(), .groups = 'drop')

# Créer un graphique en barres interactif avec Plotly
p <- plot_ly(medals_by_gender, x = ~Year, y = ~total_medals, color = ~Sex, type = 'bar',
             text = ~paste('Year:', Year, '<br>Total Medals:', total_medals, '<br>Sex:', Sex),
             hoverinfo = 'text') %>%
  layout(title = "Répartition des médailles par genre aux Jeux Olympiques",
         xaxis = list(title = "Année des Jeux Olympiques"),
         yaxis = list(title = "Nombre total de médailles"),
         barmode = 'group')

# Ajouter des étiquettes sur les barres
p <- p %>% add_annotations(x = ~Year, y = ~total_medals, text = ~total_medals,
                           showarrow = FALSE, font = list(size = 10), 
                           yshift = 5)

# Modifier les couleurs
p <- p %>% layout(colorway = c('#1f77b4', '#ff7f0e'))

# Afficher le graphique
p


```

</br><hr width="20%" /></br>

```{r Question9-D,echo=FALSE, message=FALSE, warning=FALSE, fig.align="center", fig.width = 10}



# Préparer les données des Jeux Olympiques
data_jo <- data_jo %>%
  filter(Sex == "F") %>%
  distinct() %>%
  left_join(data_noc_regions, by = "NOC") %>%
  group_by(region) %>%
  summarize(total_female_athletes = n_distinct(ID)) %>%
  ungroup()

# Fusionner les données avec les codes ISO
female_participation_map <- data_jo %>%
  left_join(data_iso_regions, by = "region") %>%
  filter(!is.na(ISO))

# Renommer la colonne pour correspondre à Plotly
female_participation_map <- female_participation_map %>%
  rename(iso_alpha = ISO)

# Créer une carte choroplèthe avec Plotly
map <- plot_ly(
  data = female_participation_map,
  type = 'choropleth',
  locations = ~iso_alpha,
  z = ~total_female_athletes,
  text = ~region,
  colorscale = 'Blues',
  autocolorscale = FALSE,
  reversescale = TRUE,
  marker = list(line = list(color = 'rgb(180,180,180)', width = 0.5)),
  colorbar = list(title = 'Nombre de participantes féminines')
) %>%
  layout(
    title = 'Participation féminine aux Jeux Olympiques par pays',
    geo = list(
      showframe = FALSE,
      showcoastlines = FALSE,
      projection = list(type = 'Mercator')
    )
  )

# Afficher la carte
map

```

</br><hr width="20%" /></br>




#### Conclusion :
